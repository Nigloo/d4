<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D4 Examples</title>
        <style>
            .axis.x path,
            .axis.x line,
            .axis.y path,
            .axis.y line {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
            }
            
            .axis text {
                font-family: sans-serif;
                font-size: 11px;
            }
            
            .whisker_limit {
                visibility: hidden;
            }
            
            .axis.radius circle,
            .axis.theta line {
                fill: none;
                stroke: grey;
                stroke-dasharray: 5 5;
            }
            
        </style>
        <script type="text/javascript" src="d3.v3.js"></script>
        <script type="text/javascript" src="d4.js"></script>
        <script type="text/javascript">
            
            "use strict";
            
            
            var sex_string = ['', 'Male', 'Female'];
            function sex(d) {
                return sex_string[d.sex];
            }
            
            var marriage_status = ['Unknown','Married','Married, Spouse Absent','Separated','Divorced','Widowed','Single'];
            function marriageStatus(d) {
                return marriage_status[d.marst];
            }
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            d4.graphic()
            .hack({ bar_padding:0, linear_scale_padding:0, drawBackground:false})
            .coord(d4.rect({x:'x', y:null,
                            subSys:d4.rect({x:'sub_cat', y:'y'})}))
            .time({t:'data:year'})
            .bar({  x:'data:age',
                    sub_cat:function(d){return d.sex.toString();},
                    y:d4.interval(0, 'data:people'),
                    fill:function(d){return d.sex == 1 ? '#1f77b4' : '#e377c2';},
                    label:'data:people'})
            .data({data:d4.loadFromFile({file:'data/census_marriage.csv'})})
            .dataView({name:'default_data', func:d4.groupBy({year:'data:year',
                                                            age:'data:age',
                                                            sex:'data:sex'})
                                                            .sum({people:'data:people'})})
            .plot({selector:"#graph1", width:960, height:500, margin:20, margin_left:80});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            d4.graphic()
            .hack({ bar_padding:0, linear_scale_padding:0, drawBackground:false})
            .coord(d4.rect({x:'x', y:null,
                            subSys:d4.rect({x:'sub_cat', y:'y'})}))
            .time({ year:'data:year',
                    age:'data:age'})
            .bar({  x:marriageStatus,
                    sub_cat:function(d){return d.sex.toString();},
                    y:d4.interval(0, 'data:people'),
                    fill:function(d){return d.sex == 1 ? '#1f77b4' : '#e377c2';},
                    label:'data:people'})
            .data({data:d4.loadFromFile({file:'data/census_marriage.csv'})})
            .dataView({name:'default_data', func:d4.filter({criteria:function(d){return d.year >= 1880;}})})
            .plot({selector:"#graph2", width:960, height:500, margin:20, margin_left:80});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////// 
            
            d4.graphic()
            .hack({drawBackground:false, bar_padding:0})
            .coord(d4.rect({y:null,
                            subSys:d4.polar({radius:null})}))
            .time({ year:'data:year'})
            .axis({axis:'theta', display:false})
            .axis({axis:'radius', display:false})
            .bar({  x:sex,
                    theta:d4.interval.stack('data:proportion'),
                    group:sex,
                    fill:'data:marst',
                    stroke:'white',
                    stroke_width:2,
                    label:function(d) {return marriage_status[d.marst]+': '+(d.proportion*100).toFixed(2)+'%';}})
            .data({data:d4.loadFromFile({file:'data/census_marriage.csv'})})
            .dataView({name:'default_data', func:d4.filter({criteria:function(d){return d.year >= 1880;}})})
            .dataView({name:'default_data', func:d4.groupBy({year:'data:year', sex:'data:sex'}).proportion({marst:'data:marst', weight:'data:people'})})
            .plot({selector:"#graph3-1", width:960, height:500, margin:20, margin_left:80});
            
            d4.graphic()
            .hack({drawBackground:false, bar_padding:0})
            .coord(d4.rect({y:null,
                            subSys:d4.polar({radius:null})}))
            .time({ year:'data:year'})
            .axis({ axis:'theta',   display:false})
            .bar({  x:sex,
                    theta:d4.interval.stack('data:proportion'),
                    fill:'data:marst',
                    stroke:'white',
                    stroke_width:2,
                    label:function(d) {return marriage_status[d.marst]+': '+(d.proportion*100).toFixed(2)+'%';}})
            .data({data:d4.loadFromFile({file:'data/census_marriage.csv'})})
            .dataView({name:'default_data', func:d4.filter({criteria:function(d){return d.year >= 1880;}})})
            .dataView({name:'default_data', func:d4.groupBy({year:'data:year', sex:'data:sex'}).proportion({marst:'data:marst', weight:'data:people'})})
            .plot({selector:"#graph3-2", width:960, height:500, margin:20, margin_left:80});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            var getColor = function(d){
                return d.sex == 1 ? 'blue' : d.sex == 2 ?'red':'green';
            }
            
            d4.graphic()
            .hack({ drawBackground:false})
            .symbol({   x:'data:height',
                        y:'data:weight',
                        stroke:getColor,
                        stroke_opacity:0.6,
                        fill:getColor,
                        fill_opacity:0.3,
                        label:function(d){return d.height+' cm, '+d.weight+' kg';}})
            .data({data:d4.loadFromFile({file:'data/HeightVersusWeight.csv'})})
            .plot({selector:"#graph4", width:960, height:500, margin:20, margin_left:80})
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            var getLabel = function(d){
                return d.height+' cm, '+d.weight+' kg';
            }
            
            d4.graphic()
            .hack({ drawBackground:false})
            .axis({axis:'x', display_axis:false})
            .element({  stroke_opacity:0.6,
                        stroke_width:1.5})
            .boxplot({  x:sex,y:d4.boxplotStat('data:weight'),
                        stroke:getColor,
                        fill:getColor,
                        fill_opacity:0.3})
            .symbol({   x:'data:x',
                        y:'data:quartile2',
                        stroke:function(d){return d.x == 'Male' ? 'blue' : 'red';},
                        fill:'white',
                        label:'data:quartile2',
                        data:'boxplot.statistic'})
            .data({data:d4.loadFromFile({file:'data/HeightVersusWeight.csv'})})
            .plot({selector:"#graph5-1", width:400, height:700})
/////////////////////////////////////////////////////////////////////////////////////////////////
            d4.graphic()
            .hack({ drawBackground:false})
            .axis({axis:'x', display_axis:false})
            .element({  stroke_opacity:0.6,
                        stroke_width:1.5})
            .boxplot({  x:sex,y:d4.boxplotStat('data:height'),
                        stroke:getColor,
                        fill:getColor,
                        fill_opacity:0.3})
            .symbol({   x:'data:x',
                        y:'data:quartile2',
                        stroke:function(d){return d.x == 'Male' ? 'blue' : 'red';},
                        fill:'white',
                        label:'data:quartile2',
                        data:'boxplot.statistic'})
            .data({data:d4.loadFromFile({file:'data/HeightVersusWeight.csv'})})
            .plot({selector:"#graph5-2", width:400, height:700})
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            var getColor = function(d){
                return d.Type == 'Allocated Budget' ? 'blue' : 'red';
            };
            
            d4.graphic()
            .hack({drawBackground:false})
            .coord(d4.polar())
            .element({  theta:'data:Function',
                        radius:'data:Budget',
                        group:'data:Type',
                        stroke:getColor})
            .line({     interpolation:'linear-closed',
                        stroke_width:2,
                        fill:getColor,
                        fill_opacity:0.2})
            .symbol({   fill:'white',
                        size:25,
                        label:function(d){return d.Type+' for '+d.Function+': $'+d.Budget+'K'}})
            .symbol({   radius:0,size:0})
            .data({data:d4.loadFromFile({file:'data/AllocatedBudgetVersusActualSpending.csv'})})
            .plot({selector:"#graph6", width:800, height:600});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
                        
            var getColor = function(d){
                return  d.operation == 'Opening Balance' || d.operation == 'Closing Balance' ? 'blue' : 
                        d.amount > 0 ? 'green' : 'red';
            };
            var getAmount = function(d){
                return d.operation == 'Closing Balance' ? -d.amount : d.amount;
            }
            
            d4.graphic()
            .hack({drawBackground:false,bar_padding:0})
            .bar({  x:'data:operation',
                    y:d4.interval.stack(getAmount),
                    stroke:getColor,
                    fill:getColor,
                    fill_opacity:0.6,
                    label:'data:amount'})
            .data({data:d4.loadFromFile({file:'data/WaterfallChartData.csv'})})
            .plot({selector:"#graph7", width:900, height:500, margin_left:60});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
            
            d4.graphic()
            .hack({drawBackground:false})
            .coord(d4.polar())
            .bar({  theta:'data:nutriment',
                    radius:d4.interval('data:quantity', 0),
                    stroke:'blue',
                    fill:'blue',
                    fill_opacity:0.3})
            .data({data:d4.loadFromFile({file:'data/AppleNutriment.csv'})})
            .plot({selector:"#graph8", width:800, height:600, margin:50});
            
/////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////
          
        </script>
    </head>
    <body>
        <div id="graph1">
            <h2>United States Population Pyramid</h2>
        </div>
        
        <div id="graph2">
            <h2>United States Census Marriage</h2>
        </div>
        <div id="graph3-1">
            <h2>United States Census Marriage Pie</h2>
        </div>
        <div id="graph3-1">
            <h2>United States Census Marriage Donuts</h2>
        </div>
        
        <div id="graph4">
            <h2>Height Versus Weight of 507 Individuals by Gender</h2>
        </div>
        <table>
            <tr>
                <td id="graph5-1">
                    <h2>Height of 507 Individuals by Gender</h2>
                </td>
                <td id="graph5-2">
                    <h2>Weight of 507 Individuals by Gender</h2>
                </td> 
            </tr>
        </table>
        <div id="graph6">
            <h2>Allocated Budget Versus Actual Spending for a given Organization</h2>
        </div>
        
        <div id="graph7">
            <h2>Waterfall Chart</h2>
        </div>
        
        <div id="graph8">
            <h2>Apple Nutriment</h2>
        </div>
        
    </body>
</html>   
